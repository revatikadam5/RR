<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="assets/css/lightbox.min.css">
	<script type="text/javascript" src="assets/js/lightbox-plus-jquery.min.js"></script>

    <title>Booking - Rangsharda Resort</title>
	
	
	 <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon">

        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Nunito:600,700" rel="stylesheet"> 
        
        <!-- CSS Libraries -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
        <link href="lib/animate/animate.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <link href="lib/flaticon/font/flaticon.css" rel="stylesheet">
        <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

        <!-- Template Stylesheet -->
        <link href="assets/css/style1.css" rel="stylesheet">
<!--

TemplateMo 548 Training Studio

https://templatemo.com/tm-548-training-studio

-->
    <!-- Additional CSS Files -->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" type="text/css" href="assets/css/font-awesome.css">

    <link rel="stylesheet" href="assets/css/booking.css">

	<link rel="stylesheet" href="assets/css/responsive.css">

	<link rel="stylesheet" href="assets/css/style.css">
	
	<!--Rooms-->
	
	<script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	
	<!-- Rooms CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/tooplate-main.css">
    <link rel="stylesheet" href="assets/css/owl.css">
	
	<!-- Additional Scripts -->
    <script src="assets/js/custom1.js"></script>
    <script src="assets/js/owl.js"></script>
    <script src="assets/js/isotope.js"></script>
	
    </head>
    
    <body>
    
    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
      <div class="preloader-inner">
        <span class="dot"></span>
        <div class="dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
    <!-- ***** Preloader End ***** -->
    
    
    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="index.html" class="logo">r<em>$</em></a>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="index.php" class="active">Home</a></li>
                            <li class="scroll-to-section"><a href="index.php #features">About</a></li>
                            <li class="scroll-to-section"><a href="index.php #our-classes">Gallery</a></li>
                            <li class="scroll-to-section"><a href="index.php #schedule">Rooms</a></li>
							<li class="scroll-to-section"><a href="index.php #trainers">Facilities</a></li>
                            <li class="scroll-to-section"><a href="index.php #contact-us">Contact</a></li> 
                            <li class="main-button1"><a href="#">BOOK NOW</a></li>
                        </ul>        
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <!-- ***** Main Banner Area Start ***** -->
    <div class="main-banner" id="top">
        <video autoplay muted loop id="bg-video">
            <source src="assets/images/room-video.mp4" type="video/mp4" />
        </video>

        <div class="video-overlay header-text">
            <div class="caption">
                <h2>BOOK<em>ING</em></h2>
            </div>
        </div>
    </div>
    <!-- ***** Main Banner Area End ***** -->

    <marquee><h4 style="margin-top:30px">Booking will be confirmed once the payment is done.</h4></marquee>

    <!-- Booking Start -->
        <div class="booking">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7">
                        <div class="booking-content">
                            <div class="section-header">
                                <p>Book A Room</p>
                                <h2>Book Your Room For Happy Vacation, Enjoy!!!</h2>
                            </div>
                           
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="booking-form">
                            <form method="POST">
                                <div class="control-group">
                                    <div class="input-group">
                                        <input type="text" name="fname" class="form-control" placeholder="First Name" required="required" />
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="far fa-user"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group">
                                        <input type="text" name="lname" class="form-control" placeholder="Last Name" required="required" />
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="far fa-user"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group">
                                        <input type="email" name="email" class="form-control" placeholder="Email" required="required" />
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="far fa-envelope"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group">
                                        <input type="text" name="mobile" class="form-control" placeholder="Mobile" required="required" />
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="fas fa-mobile-alt"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group date" id="date1" data-target-input="nearest">
                                        <input type="text" name="checkin" class="form-control datetimepicker-input" placeholder="Check-In Date" onfocus="(this.type='date')"data-target="#date" data-toggle="datetimepicker"/>
                                        <div class="input-group-append" data-target="#date" data-toggle="datetimepicker">
                                            <div class="input-group-text"><i class="far fa-calendar-alt"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group date" id="date2" data-target-input="nearest">
                                        <input type="text" name="checkout" class="form-control datetimepicker-input" placeholder="Check-Out Date" onfocus="(this.type='date')"data-target="#date" data-toggle="datetimepicker"/>
                                        <div class="input-group-append" data-target="#date" data-toggle="datetimepicker">
                                            <div class="input-group-text"><i class="far fa-calendar-alt"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group">
                                        <select name="member" class="custom-select form-control">
                                            <option selected>Members</option>
                                            <option value="1">1 Person</option>
                                            <option value="2">2 Person</option>
                                            <option value="3">3 Person</option>
                                            <option value="4">4 Person</option>
                                            <option value="5">5 Person</option>
                                            <option value="6">6 Person</option>
                                            <option value="7">7 Person</option>
                                            <option value="8">8 Person</option>
                                            <option value="9">9 Person</option>
                                            <option value="10">10 Person</option>
                                        </select>
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="fa fa-chevron-down"></i></div>
                                        </div>
                                    </div>
                                </div>
								<div class="control-group">
                                    <div class="input-group">
                                        <select name="type" class="custom-select form-control">
                                            <option selected>Room Type</option>
                                            <option value="Single Bed Non AC Room">Single Bed Non AC Room</option>
                                            <option value="Single Bed AC Room">Single Bed AC Room</option>
											<option value="Double Bed Non AC Room">Double Bed Non AC Room</option>
                                            <option value="Double Bed AC Room">Double Bed AC Room</option>
											<option value="Deluxe Non AC Room">Deluxe Non AC Room</option>
                                            <option value="Deluxe AC Room">Deluxe AC Room</option>
                                            <option value="Super Deluxe Non AC Room">Super Deluxe Non AC Room</option>
											<option value="Super Deluxe AC Room">Super Deluxe AC Room</option>
                                        </select>
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="fa fa-chevron-down"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="input-group">
                                        <select name="description" class="custom-select form-control">
                                            <option selected>Description</option>
                                            <option value="With Breakfast">With Breakfast</option>
                                            <option value="Without Breakfast">Without Breakfast</option>
                                        </select>
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="fa fa-chevron-down"></i></div>
                                        </div>
                                    </div>
                                </div>
								<div class="control-group">
                                    <div class="input-group">
                                        <select name="room" class="custom-select form-control">
                                            <option selected>Rooms</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                        <div class="input-group-append">
                                            <div class="input-group-text"><i class="fa fa-chevron-down"></i></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn custom-btn" name="btn-submit" type="submit">Book Now</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Booking End -->
	

        <?php
        $conn = mysqli_connect("localhost","root","","Rangsharda");
        if(mysqli_connect_error())
        {
            echo mysqli_connect_errno();
            die();
        }
        else if(isset($_POST['btn-submit']))
        {
            $fname = $_POST['fname'];
            $lname = $_POST['lname'];
            $email = $_POST['email'];
            $mobile = $_POST['mobile'];
            $checkin = $_POST['checkin'];
            $checkout = $_POST['checkout'];
            $members = $_POST['member'];
            $type = $_POST['type'];
            $description = $_POST['description'];
            $rooms = $_POST['room'];
            $status = "pending";

            

            $cnt = 0;
            $query5 = "select room_no from room_demo where room_type='$type' and room_no not in(select room_no from room_book_map,booking_demo where booking_demo.book_id=room_book_map.book_id and check_in_date<='$checkin' and check_out_date>='$checkout') ";
            $result5 = mysqli_query($conn,$query5);
            
            while($row = mysqli_fetch_array($result5))
            {
                $r = $row['room_no'];
                $cnt=$cnt+1;
            }
            
            /*$query6 = "select count(room_type) from room_demo where room_type='$type' group by room_type";
            $result6 = mysqli_query($conn,$query6);*/
            if($cnt==0)
            {
                ?>
                <h3 style="text-align:center; margin-top:70px; margin-bottom:30px"><?php echo"Sorry!!  We have no $type left"?></h3><?php
            }

            else if($rooms > $cnt)
            {
                ?>
                <h3 style="text-align:center; margin-top:70px; margin-bottom:30px"><?php echo"Sorry!!  We have only $cnt $type left"?></h3><?php
            }
            
            else
            {
                $query1 = "insert into customer_demo (cust_fname,cust_lname,cust_email,cust_mob) values ('$fname','$lname','$email','$mobile')";
            $result1 = mysqli_query($conn,$query1);

            $query2 = "select cust_id from customer_demo where cust_fname='$fname' and cust_lname='$lname'";
            $result2 = mysqli_query($conn,$query2);
            while($row = mysqli_fetch_array($result2))
            {
                $id = $row['cust_id'];
            }

            $query3 = "insert into booking_demo (check_in_date,check_out_date,description,no_of_members,no_of_rooms,room_type,book_status,cust_id) values ('$checkin','$checkout','$description','$members','$rooms','$type','$status','$id')";
            $result3 = mysqli_query($conn,$query3);          

            $query4 = "select book_id from booking_demo,customer_demo where customer_demo.cust_id=booking_demo.cust_id";
            $result4 = mysqli_query($conn,$query4);
            while($row = mysqli_fetch_array($result4))
            {
                $b_id = $row['book_id'];
            }
                for($i=0;$i<$rooms;$i++)
                    {
                        $query7 = "select room_no from room_demo where room_type='$type' and room_no not in(select room_no from room_book_map,booking_demo where booking_demo.book_id=room_book_map.book_id and check_in_date<='$checkin' and check_out_date>='$checkout') ORDER by RAND() LIMIT 1 ";
                        $result7 = mysqli_query($conn,$query7);            
                        while($row = mysqli_fetch_array($result7))
                        {
                            $res = $row['room_no'];
                        }
            
                        $query8 = "insert into room_book_map (book_id,room_no) values ('$b_id','$res')";
                        $result8 = mysqli_query($conn,$query8);
                    }
            }
        
        }
        

        ?>
	
    <!-- ***** Footer Start ***** -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; 2021 Rangsharda Resort
                    
                    - Designed by <a rel="nofollow" href="https://templatemo.com" class="tm-text-link" target="_parent">RS Tech</a></p>
                    
                    <!-- You shall support us a little via PayPal to info@templatemo.com -->
                    
                </div>
            </div>
        </div>
    </footer>


    <!-- jQuery -->
    <script src="assets/js/jquery-2.1.0.min.js"></script>

    <!-- Bootstrap -->
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- Plugins -->
    <script src="assets/js/scrollreveal.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/imgfix.min.js"></script> 
    <script src="assets/js/mixitup.js"></script> 
    <script src="assets/js/accordions.js"></script>
    
    <!-- Global Init -->
    <script src="assets/js/custom.js"></script>

  </body>
</html>